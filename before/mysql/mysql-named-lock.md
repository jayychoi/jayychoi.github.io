---
title:
slug:
created:
updated:
description:
category:
tags:
# published: true
---

# MySQL 네임드 락

## 네임드 락이란?

네임드 락은 **사용자가 정의한 임의의 이름**을 기반으로 하는 애플리케이션 수준의 락이다.
테이블이나 행에 대한 락이 아니라, 임의의 문자열을 "락 이름"으로 사용하여 여러 세션 간의 동기화를 구현한다.

### 네임드 락의 특성

- 네임드 락은 세션(연결)에 종속된다. 세션이 종료되면 모든 락이 자동으로 해제된다.
- 네임드 락은 트랜잭션과 무관하게 동작한다. 커밋해도 락은 해제되지 않는다. 명시적 해제가 필요하다.
- 네임드 락의 이름은 서버 전체에서 전역적이고, 대소문자를 구분하지 않는다.

## 네임드 락 관련 함수

### `GET_LOCK(name, timeout)`

`name`에 대해 락을 획득한다.

```sql
SELECT GET_LOCK('my_lock', 10);
```

#### 파라미터

- `name`: 락 이름 (최대 64자)
- `timeout`: 대기 시간 (초 단위, 음수면 무한 대기)

#### 반환값

| 값     | 설명                                    |
| ------ | --------------------------------------- |
| `1`    | 락 획득 성공                            |
| `0`    | 타임아웃 (락 획득 실패)                 |
| `NULL` | 에러 발생 (메모리 부족, 스레드 종료 등) |

### `RELEASE_LOCK(name)`

획득한 `name` 락을 해제한다.

```sql
SELECT RELEASE_LOCK('my_lock');
```

#### 반환값

| 값     | 설명                                                   |
| ------ | ------------------------------------------------------ |
| `1`    | 락 해제 성공                                           |
| `0`    | 현재 세션이 해당 락을 보유하지 않음 (다른 세션이 보유) |
| `NULL` | 해당 이름의 락이 존재하지 않음                         |

### `IS_FREE_LOCK(name)`

`name` 락이 사용 가능한지 확인한다.

```sql
SELECT IS_FREE_LOCK('my_lock');
```

#### 반환값

| 값     | 설명                                  |
| ------ | ------------------------------------- |
| `1`    | 락이 사용 가능 (아무도 보유하지 않음) |
| `0`    | 락이 사용 중                          |
| `NULL` | 에러 발생                             |

### `IS_USED_LOCK(name)`

`name` 락을 보유한 세션의 connection ID를 반환한다.

```sql
SELECT IS_USED_LOCK('my_lock');
```

#### 반환값

| 값              | 설명                  |
| --------------- | --------------------- |
| `connection_id` | 락을 보유한 세션의 ID |
| `NULL`          | 락이 사용 중이 아님   |

### `RELEASE_ALL_LOCKS()`

현재 세션이 보유한 모든 네임드 락을 해제한다.

```sql
SELECT RELEASE_ALL_LOCKS();
```

#### 반환값

해제된 락의 개수
