# How Claude Code Works - 심층 분석

이 문서는 Claude Code의 **핵심 아키텍처와 사용 철학**을 설명합니다. 핵심 개념을 계층별로 분석합니다.

## 1. 에이전틱 루프 - Claude Code의 심장

Claude Code의 가장 근본적인 설계 원리는 **에이전틱 루프(Agentic Loop)**입니다. 이것은 단순한 "질문-응답" 패턴이 아닙니다.

```
컨텍스트 수집 → 행동 수행 → 결과 검증 → (반복)
```

핵심 통찰은 이 세 단계가 **고정된 순서가 아니라 상황에 따라 유동적으로 혼합된다**는 점입니다. 예를 들어:
- 단순 질문: 컨텍스트 수집만으로 끝남
- 버그 수정: 세 단계를 여러 번 반복
- 리팩토링: 검증 단계에 가장 많은 시간을 소비

이것이 기존 코드 어시스턴트(Copilot 등)와의 결정적 차이입니다. Copilot은 현재 파일의 컨텍스트에서 코드를 제안하지만, Claude Code는 **프로젝트 전체를 횡단하며 자율적으로 작업 체인을 구성**합니다.

## 2. 에이전틱 하네스(Agentic Harness)라는 아키텍처

문서에서 Claude Code를 **"에이전틱 하네스"**라고 정의합니다. 이것은 중요한 구분입니다:

- **Claude 모델** = 추론 엔진 (두뇌)
- **Claude Code** = 실행 환경 (몸체)

Claude 모델 자체는 텍스트만 생성할 수 있습니다. Claude Code가 도구, 파일 시스템 접근, 셸 실행 환경을 제공함으로써 모델이 실제로 **행동**할 수 있게 됩니다. 이는 LLM 에이전트 설계의 전형적인 패턴으로, 모델의 추론 능력과 외부 도구의 실행 능력을 분리합니다.

## 3. 도구 시스템 - 4+1 범주

도구가 5가지 범주로 나뉘는 것에 주목할 필요가 있습니다:

| 범주 | 성격 |
|---|---|
| 파일 작업 | 프로젝트 변경의 핵심 |
| 검색 | 컨텍스트 수집의 핵심 |
| 실행 | 외부 세계와의 상호작용 |
| 웹 | 외부 지식 접근 |
| 코드 인텔리전스 | IDE 수준의 이해 (플러그인 필요) |

각 도구 사용은 **피드백 루프**를 형성합니다. 도구의 결과가 다음 추론의 입력이 되며, 이것이 에이전틱 루프를 구동하는 메커니즘입니다.

## 4. 세션 모델 - 일시적이지만 관리 가능

세션에 대한 설계 결정이 흥미롭습니다:

- **영구 메모리 없음**: 의도적인 설계. 세션 간 학습이 없음
- **CLAUDE.md로 보완**: 영구적이어야 할 지식은 파일로 명시적 관리
- **포크(Fork) 지원**: 같은 시작점에서 여러 접근을 병렬 탐색 가능

이것은 **재현 가능성(reproducibility)**과 **예측 가능성(predictability)**을 중시한 설계입니다. 세션 간 암묵적 학습이 있으면 동작이 예측 불가능해질 수 있습니다.

## 5. 컨텍스트 윈도우 관리 - 실전적 제약

컨텍스트 윈도우는 Claude Code 사용의 가장 실질적인 제약입니다. 문서가 제시하는 전략:

- **자동 압축**: 오래된 도구 출력부터 제거, 필요시 대화 요약
- **스킬의 지연 로딩**: 설명만 먼저 로드, 전체 내용은 사용 시 로드
- **서브에이전트 격리**: 별도 컨텍스트에서 실행, 메인 컨텍스트를 오염시키지 않음
- **CLAUDE.md에 핵심 규칙 저장**: 압축 시에도 CLAUDE.md는 보존됨

특히 MCP 서버가 **모든 요청에 도구 정의를 추가**한다는 점은 실전에서 중요한 고려사항입니다.

## 6. 효과적 사용의 핵심 원칙

문서의 사용 팁을 관통하는 원칙은 **"위임 모델(Delegation Model)"**입니다:

- **구체적 프롬프트**: 파일 경로, 제약 조건, 예제 패턴을 제공
- **검증 가능한 목표**: 테스트 케이스, 스크린샷 등 Claude가 스스로 확인할 수 있는 기준 제공
- **탐색과 구현의 분리**: 계획 모드로 먼저 분석, 그 후 구현
- **과정 제어**: 완벽한 프롬프트보다 대화를 통한 반복적 개선

이것은 시니어 엔지니어에게 작업을 위임하는 방식과 동일합니다. "무엇을"과 "왜"를 설명하되, "어떻게"는 에이전트에게 맡기는 것입니다.
